<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@eyevinn/autovmaf</title><meta name="description" content="Documentation for @eyevinn/autovmaf"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@eyevinn/autovmaf</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>@eyevinn/autovmaf </h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography"><div align="center">


<a href="#" id="" style="color: inherit; text-decoration: none;">
  <h1><a href="https://github.com/eyevinn/autovmaf"><img src="https://raw.githubusercontent.com/Eyevinn/autovmaf/main/AutoVMAF.svg" alt="autovmaf" height="100"></a></h1>
</a>
<p>autovmaf - A toolkit to automatically encode multiple bitrates and perform automated VMAF measurements on all of them.</p>
<p>ðŸ“– <strong><a href="https://eyevinn.github.io/autovmaf/">Read the documentation</a></strong> ðŸ‘€</p>
<p><a href="https://github.com/eyevinn/autovmaf/issues/new?assignees=&amp;labels=bug&amp;template=01_BUG_REPORT.md&amp;title=bug%3A+">Report a Bug</a>
Â·
<a href="https://github.com/eyevinn/autovmaf/issues/new?assignees=&amp;labels=enhancement&amp;template=02_FEATURE_REQUEST.md&amp;title=feat%3A+">Request a Feature</a></p>
<p><a href="https://www.npmjs.com/package/@eyevinn/autovmaf"><img src="https://img.shields.io/npm/v/@eyevinn/autovmaf?style=flat-square" alt="license"></a>
<a href="https://github.com/Eyevinn/autovmaf/releases"><img src="https://img.shields.io/github/v/release/Eyevinn/autovmaf?style=flat-square" alt="license"></a>
<a href="LICENSE"><img src="https://img.shields.io/github/license/eyevinn/autovmaf.svg?style=flat-square" alt="license"></a></p>
<p><a href="https://github.com/eyevinn/autovmaf/issues?q=is%3Aissue+is%3Aopen+label%3A%22help+wanted%22"><img src="https://img.shields.io/badge/PRs-welcome-ff69b4.svg?style=flat-square" alt="PRs welcome"></a>
<a href="https://github.com/eyevinn"><img src="https://img.shields.io/badge/made%20with%20%E2%99%A5%20by-Eyevinn-59cbe8.svg?style=flat-square" alt="made with hearth by Eyevinn"></a></p>
</div>

<p>By optimizing ABR-ladders for specific content, you will make sure to not have wasteful rungs and this has been shown to <a href="https://dev.to/video/automating-video-analysis-to-cut-your-streaming-bandwidth-usage-in-half-5hk1">cut bandwidth usage in half</a>.</p>

<a href="#usage" id="usage" style="color: inherit; text-decoration: none;">
  <h2>Usage</h2>
</a>
<p>Transcoding and VMAF analysis can either be run in AWS or locally. When running in aws, you will need a running ECS cluster with a task definition configured to run <a href="https://github.com/Eyevinn/easyvmaf_s3">easyvmaf-s3</a>.</p>

<a href="#installation" id="installation" style="color: inherit; text-decoration: none;">
  <h3>Installation</h3>
</a>
<pre><code class="language-bash"><span class="hl-1">npm install --save @eyevinn/autovmaf</span>
</code></pre>

<a href="#environment-variables" id="environment-variables" style="color: inherit; text-decoration: none;">
  <h3>Environment Variables</h3>
</a>
<p>A few environment variables can be set. These are:</p>
<pre><code class="language-bash"><span class="hl-1">LOAD_CREDENTIALS_FROM_ENV=true   //Load AWS credentials from environment variables</span><br/><span class="hl-1">AWS_REGION=eu-north-1</span><br/><span class="hl-1">AWS_ACCESS_KEY_ID=ABCD...</span><br/><span class="hl-1">AWS_SECRET_ACCESS_KEY=EFGH...</span>
</code></pre>

<a href="#generate-vmaf-measurements" id="generate-vmaf-measurements" style="color: inherit; text-decoration: none;">
  <h3>Generate VMAF measurements</h3>
</a>
<p>To generate VMAF measurements, you will need to define a job which can be created with the <code>createJob()</code>-function.</p>
<pre><code class="language-typescript"><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">createJob</span><span class="hl-1"> } = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&#39;@eyevinn/autovmaf&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">vmafScores</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-3">createJob</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-6">name:</span><span class="hl-1"> </span><span class="hl-4">&#39;MyVMAFmeasurements&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">pipeline:</span><span class="hl-1"> </span><span class="hl-4">&#39;pipeline.yml&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">encodingProfile:</span><span class="hl-1"> </span><span class="hl-4">&#39;profile.json&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">reference:</span><span class="hl-1"> </span><span class="hl-4">&#39;reference.mp4&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">models:</span><span class="hl-1"> [</span><span class="hl-4">&#39;HD&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;PhoneHD&#39;</span><span class="hl-1">], </span><span class="hl-8">// optional</span><br/><span class="hl-1">  </span><span class="hl-6">resolutions:</span><span class="hl-1"> [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-8">// optional</span><br/><span class="hl-1">      </span><span class="hl-6">width:</span><span class="hl-1"> </span><span class="hl-7">1280</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-6">height:</span><span class="hl-1"> </span><span class="hl-7">720</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-6">range:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-8">// optional</span><br/><span class="hl-1">        </span><span class="hl-6">min:</span><span class="hl-1"> </span><span class="hl-7">500000</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-6">max:</span><span class="hl-1"> </span><span class="hl-7">600000</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-6">bitrates:</span><span class="hl-1"> [</span><br/><span class="hl-1">    </span><span class="hl-8">// optional</span><br/><span class="hl-1">    </span><span class="hl-7">500000</span><span class="hl-1">, </span><span class="hl-7">600000</span><span class="hl-1">, </span><span class="hl-7">800000</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-6">method:</span><span class="hl-1"> </span><span class="hl-4">&#39;bruteForce&#39;</span><span class="hl-1"> </span><span class="hl-8">// optional</span><br/><span class="hl-1">});</span>
</code></pre>
<p>When creating a job, you can specify:</p>
<ul>
<li><strong>Name</strong><ul>
<li>This will name the folder in which to put the files.</li>
</ul>
</li>
<li><strong>Pipeline</strong><ul>
<li>Path to a YAML-file that defines the pipeline. See <a href="https://github.com/Eyevinn/autovmaf/blob/main/examples/aws/pipeline.yml"><code>examples/pipeline.yml</code></a> for an example AWS-pipeline.</li>
<li>When running locally, pipeline data can be inlined in the job definition.</li>
</ul>
</li>
<li><strong>Encoding Profile</strong><ul>
<li>Path to a JSON-file that defines how the reference should be encoded. When using AWS, this is a MediaConvert configuration. See an example for AWS at <a href="https://github.com/Eyevinn/autovmaf/blob/main/examples/encoding-profile.json"><code>examples/aws/encoding-profile.json</code></a>.
For local pipelines, this is key-value pairs that will be passed as command line arguments to FFmpeg. If pipeline
data is inlined in the job definition, encodingProfile can be omitted and key-value pairs can instead be set
in the <code>ffmpegOptions</code> property of the pipeline object.</li>
</ul>
</li>
<li><strong>Reference</strong><ul>
<li>Path to the reference video to analyze. Normally a local path, but when using AWS, this can also be an S3-URI.</li>
</ul>
</li>
<li><strong>Models</strong> (optional)<ul>
<li>A list of VMAF-models to use in evaluation. This can be HD, MobileHD and UHD. HD by default.</li>
</ul>
</li>
<li><strong>Resolutions</strong> (optional)<ul>
<li>A list of resolutions to test. By default it will test all resolutions in the example ABR-ladder provided by Apple in the <a href="https://developer.apple.com/documentation/http_live_streaming/hls_authoring_specification_for_apple_devices">HLS Authoring Spec</a>.</li>
<li><strong>Range</strong> (optional)<ul>
<li>A min and max bitrate for testing a specific resolution. Adding a range will filter out bitrates that are outside of the given range. It is disabled by default.</li>
</ul>
</li>
</ul>
</li>
<li><strong>Bitrates</strong> (optional)<ul>
<li>A list of bitrates to test. By default a list of bitrates between 150 kbit/s to 9000 kbit/s.</li>
</ul>
</li>
<li><strong>Method</strong> (optional)<ul>
<li>The method to use when analyzing the videos. Either <code>bruteForce</code> or <code>walkTheHull</code>. By default <code>bruteForce</code>. NOTE: <code>walkTheHull</code> is not implemented at the moment.</li>
</ul>
</li>
</ul>

<a href="#create-job-using-yaml" id="create-job-using-yaml" style="color: inherit; text-decoration: none;">
  <h3>Create job using yaml</h3>
</a>
<pre><code class="language-typescript"><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">createJob</span><span class="hl-1"> } = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&#39;@eyevinn/autovmaf&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">YAML</span><span class="hl-1"> = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&#39;yaml&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">fs</span><span class="hl-1"> = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&#39;fs&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-3">parseResolutions</span><span class="hl-1"> = (</span><span class="hl-6">resolutions</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">resolutions</span><span class="hl-1">.</span><span class="hl-3">map</span><span class="hl-1">((</span><span class="hl-6">resolutionStr</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">    </span><span class="hl-6">width:</span><span class="hl-1"> </span><span class="hl-3">parseInt</span><span class="hl-1">(</span><span class="hl-6">resolutionStr</span><span class="hl-1">.</span><span class="hl-3">split</span><span class="hl-1">(</span><span class="hl-4">&#39;x&#39;</span><span class="hl-1">)[</span><span class="hl-7">0</span><span class="hl-1">]),</span><br/><span class="hl-1">    </span><span class="hl-6">height:</span><span class="hl-1"> </span><span class="hl-3">parseInt</span><span class="hl-1">(</span><span class="hl-6">resolutionStr</span><span class="hl-1">.</span><span class="hl-3">split</span><span class="hl-1">(</span><span class="hl-4">&#39;x&#39;</span><span class="hl-1">)[</span><span class="hl-7">1</span><span class="hl-1">])</span><br/><span class="hl-1">  }));</span><br/><span class="hl-1">};</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">jobFile</span><span class="hl-1"> = </span><span class="hl-6">fs</span><span class="hl-1">.</span><span class="hl-3">readFileSync</span><span class="hl-1">(</span><span class="hl-4">&#39;job.yml&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;utf-8&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">jobData</span><span class="hl-1"> = </span><span class="hl-2">YAML</span><span class="hl-1">.</span><span class="hl-3">parse</span><span class="hl-1">(</span><span class="hl-6">jobFile</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">job</span><span class="hl-1"> = {</span><br/><span class="hl-1">  ...</span><span class="hl-6">jobData</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">resolutions:</span><br/><span class="hl-1">    </span><span class="hl-6">jobData</span><span class="hl-1">[</span><span class="hl-4">&#39;resolutions&#39;</span><span class="hl-1">] !== </span><span class="hl-0">undefined</span><br/><span class="hl-1">      ? </span><span class="hl-3">parseResolutions</span><span class="hl-1">(</span><span class="hl-6">jobData</span><span class="hl-1">[</span><span class="hl-4">&#39;resolutions&#39;</span><span class="hl-1">])</span><br/><span class="hl-1">      : </span><span class="hl-0">undefined</span><br/><span class="hl-1">};</span><br/><span class="hl-3">createJob</span><span class="hl-1">(</span><span class="hl-6">job</span><span class="hl-1">);</span>
</code></pre>
<p><strong>An example of creating a job from a YAML-file can be seen in the <a href="https://github.com/Eyevinn/autovmaf/tree/main/examples/"><code>examples-folder</code></a>.</strong></p>

<a href="#read-vmaf-scores" id="read-vmaf-scores" style="color: inherit; text-decoration: none;">
  <h3>Read VMAF-scores</h3>
</a>
<p>Using <code>getVmaf()</code>, you can read VMAF-scores from a JSON-file or a directory of JSON-files. This works on both local paths as well as S3-URIs with a &quot;s3://&quot;-prefix.</p>
<p>Example:</p>
<pre><code class="language-javascript"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">vmafFiles</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-3">getVmaf</span><span class="hl-1">(</span><span class="hl-4">&#39;s3://path/to/vmaf/&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-6">vmafFiles</span><span class="hl-1">.</span><span class="hl-3">forEach</span><span class="hl-1">((</span><span class="hl-6">file</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-6">file</span><span class="hl-1">.</span><span class="hl-6">filename</span><span class="hl-1"> + </span><span class="hl-4">&#39;: &#39;</span><span class="hl-1"> + </span><span class="hl-6">file</span><span class="hl-1">.</span><span class="hl-6">vmaf</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code></pre>

<a href="#cli-usage" id="cli-usage" style="color: inherit; text-decoration: none;">
  <h2>CLI Usage</h2>
</a>
<p>When running with the cli, all transcoding and vmaf analysis will be run locally.</p>

<a href="#requirements" id="requirements" style="color: inherit; text-decoration: none;">
  <h3>Requirements</h3>
</a>
<ul>
<li><a href="https://github.com/gdavila/easyVmaf">easyVmaf</a></li>
<li><a href="https://www.ffmpeg.org/">FFmpeg</a> &gt;= 5.0, compiled with libvmaf</li>
<li><a href="https://www.python.org">Python</a> &gt;= 3.0</li>
</ul>

<a href="#global-installation" id="global-installation" style="color: inherit; text-decoration: none;">
  <h3>Global installation</h3>
</a>
<p>Installing globally with <code>npm -g</code> will make the <code>autovmaf</code> command available in your path</p>
<pre><code class="language-bash"><span class="hl-1">npm install -g @eyevinn/autovmaf</span>
</code></pre>

<a href="#environments-variables" id="environments-variables" style="color: inherit; text-decoration: none;">
  <h3>Environments variables</h3>
</a>
<p>These are only needed if you are running transcodes and VMAF measurements locally</p>
<ul>
<li><code>EASYVMAF_PATH</code> - needs to point to the file <code>easyVmaf.py</code> from your
easyVmaf installation.</li>
<li><code>FFMPEG_PATH</code> - only needs to be set if ffmpeg is not in your path.</li>
<li><code>PYTHON_PATH</code> - only needs to be set if python is not in your path.</li>
</ul>

<a href="#command-line-options" id="command-line-options" style="color: inherit; text-decoration: none;">
  <h3>Command line options</h3>
</a>
<p>Available command line options for the cli can be listed with the <code>--help</code> argument</p>
<pre><code class="language-bash"><span class="hl-1">autovmaf [source]</span><br/><br/><span class="hl-1">run transcode and vmaf analysis </span><span class="hl-5">for</span><span class="hl-1"> videofile </span><span class="hl-3">source</span><br/><br/><span class="hl-1">Commands:</span><br/><span class="hl-1">  autovmaf [source]                 run transcode and vmaf analysis </span><span class="hl-5">for</span><br/><span class="hl-1">                                    videofile </span><span class="hl-3">source</span><span class="hl-1">                   [default]</span><br/><span class="hl-1">  autovmaf suggest-ladder &lt;folder&gt;  Suggest bitrate ladder given vmaf results</span><br/><span class="hl-1">  autovmaf export-csv &lt;folder&gt;      Export Vmaf results as csv</span><br/><br/><span class="hl-1">Positionals:</span><br/><span class="hl-1">  </span><span class="hl-3">source</span><span class="hl-1">  SOURCEFILE                                                    [string]</span><br/><br/><span class="hl-1">Options:</span><br/><span class="hl-1">  --version         Show version number                                [boolean]</span><br/><span class="hl-1">  --help            Show </span><span class="hl-3">help</span><span class="hl-1">                                          [boolean]</span><br/><span class="hl-1">  --resolutions     List of resolutions, ie 1920x1080,1280x720...       [string]</span><br/><span class="hl-1">  --bitrates        List of bitrates, ie 800k,1000k,...                 [string]</span><br/><span class="hl-1">  --name            Name </span><span class="hl-5">for</span><span class="hl-1"> this autovmaf run                          [string]</span><br/><span class="hl-1">  --models          List of VMAF Models to use                          [string]</span><br/><span class="hl-1">  --job             File with job definition                            [string]</span><br/><span class="hl-1">  --saveAsCsv       Save VMAF measurements as a .csv file </span><span class="hl-5">in</span><span class="hl-1"> addition to a JSON</span><br/><span class="hl-1">                    file                              [boolean] [default: false]</span><br/><span class="hl-1">  --skipTranscode   Skip transcode and run vmaf on already transcoded files</span><br/><span class="hl-1">                                                      [boolean] [default: false]</span><br/><span class="hl-1">  --skipExisting    Skip transcode </span><span class="hl-5">for</span><span class="hl-1"> already transcoded files</span><br/><span class="hl-1">                                                       [boolean] [default: true]</span><br/><span class="hl-1">  --probeBitrate    Read bitrate of transcoded file with ffprobe</span><br/><span class="hl-1">                                                      [boolean] [default: false]</span><br/><span class="hl-1">  --ffmpeg-options  List of options to pass to ffmpeg, on the form</span><br/><span class="hl-1">                    key1=value1:key2=value2                             [string]</span>
</code></pre>

<a href="#running-transcode-and-analysis" id="running-transcode-and-analysis" style="color: inherit; text-decoration: none;">
  <h3>Running transcode and analysis</h3>
</a>
<p>Output files will be stored in a folder corresponding to the argument given to the <code>--name</code> option.
If resolutions and/or bitrates are not specified default values will be used, <a href="#generate-vmaf-measurements">See above</a>.</p>

<a href="#providing-job-definition-in-a-json-or-yaml-file" id="providing-job-definition-in-a-json-or-yaml-file" style="color: inherit; text-decoration: none;">
  <h4>Providing job definition in a json or yaml file</h4>
</a>
<p>With the <code>--job</code> option, a path to a yaml or json file with a job definition can be passed to to the cli. The values
defined in the file can be overridden with other commandline options. For instance the <code>reference</code> video defined
in the job file can be overridden by passing a source file on the command line.</p>

<a href="#using-variables-in-the-job-definition" id="using-variables-in-the-job-definition" style="color: inherit; text-decoration: none;">
  <h5>Using variables in the job definition</h5>
</a>
<p>It is possible to iterate over other variables than bitrate and resolutions when running a local encode. For
instance, to run transcode and vmaf analysis with x265 in CRF mode for a number of CRF values, a job definition
like below can be used (also available in <a href="examples/local/local-job-crf.yaml">examples/local/local-job-crf.yaml</a>)</p>
<pre><code class="language-yaml"><span class="hl-9">models</span><span class="hl-1">:</span><br/><span class="hl-1">  - </span><span class="hl-10">HD</span><br/><span class="hl-9">resolutions</span><span class="hl-1">:</span><br/><span class="hl-1">  - </span><span class="hl-9">width</span><span class="hl-1">: </span><span class="hl-7">1920</span><br/><span class="hl-1">    </span><span class="hl-9">height</span><span class="hl-1">: </span><span class="hl-7">1080</span><br/><span class="hl-9">bitrates</span><span class="hl-1">:</span><br/><span class="hl-1">  - </span><span class="hl-7">0</span><br/><span class="hl-9">pipeline</span><span class="hl-1">:</span><br/><span class="hl-1">  </span><span class="hl-9">ffmpegEncoder</span><span class="hl-1">: </span><span class="hl-10">libx265</span><br/><span class="hl-1">  </span><span class="hl-9">singlePass</span><span class="hl-1">: </span><span class="hl-0">true</span><br/><span class="hl-1">  </span><span class="hl-9">skipDefaultOptions</span><span class="hl-1">: </span><span class="hl-0">true</span><br/><span class="hl-1">  </span><span class="hl-9">ffmpegOptions</span><span class="hl-1">:</span><br/><span class="hl-1">    </span><span class="hl-10">&#39;-pix_fmt&#39;</span><span class="hl-1">: </span><span class="hl-10">&#39;yuv420p&#39;</span><br/><span class="hl-1">    </span><span class="hl-10">&#39;-preset&#39;</span><span class="hl-1">: </span><span class="hl-10">&#39;veryslow&#39;</span><br/><span class="hl-1">    </span><span class="hl-10">&#39;-x265-params&#39;</span><span class="hl-1">: </span><span class="hl-10">&#39;crf=${CRF}:scenecut=0:keyint=50:min-keyint=50:open-gop=0&#39;</span><br/><span class="hl-1">  </span><span class="hl-9">easyVmafExtraArgs</span><span class="hl-1">:</span><br/><span class="hl-1">    </span><span class="hl-10">&#39;-threads&#39;</span><span class="hl-1">: </span><span class="hl-7">20</span><br/><span class="hl-9">pipelineVariables</span><span class="hl-1">:</span><br/><span class="hl-1">  </span><span class="hl-9">CRF</span><span class="hl-1">:</span><br/><span class="hl-1">    - </span><span class="hl-7">22</span><br/><span class="hl-1">    - </span><span class="hl-7">26</span><br/><span class="hl-1">    - </span><span class="hl-7">30</span><br/><span class="hl-1">    - </span><span class="hl-7">34</span>
</code></pre>
<p>This will run transcode and vmaf analysis for CRF values 22,26,30, and 34. Variables are used in the ffmpeg options
by inserting <code>${VARIABLENAME}</code>. This string will then be substituted with a value from the list of values from
<code>pipelineVariables.VARIABLENAME</code>. Note that when running CRF encode or other non-ABR mode, <code>skipDefaultOptions</code> must
be set to avoid injecting bitrate options to ffmpeg. Also note that the cli needs to be run with the <code>--probe-bitrate</code>
option to get the correct bitrate from the transcoded files.</p>
<p>It is also possible to use pipelineVariables with the AWSPipeline. The following example will run transcode and vmaf analysis using the AWS MediaCOnvert QVBR levels 6, 7, 8 and 9.</p>
<pre><code class="language-yaml"><span class="hl-9">name</span><span class="hl-1">: </span><span class="hl-10">job-name</span><br/><span class="hl-9">pipeline</span><span class="hl-1">: </span><span class="hl-10">pipeline.yml</span><br/><span class="hl-9">encodingProfile</span><span class="hl-1">: </span><span class="hl-10">encoding-profile.json</span><br/><span class="hl-9">reference</span><span class="hl-1">: </span><span class="hl-10">reference.mp4</span><br/><span class="hl-9">models</span><span class="hl-1">:</span><br/><span class="hl-1">  - </span><span class="hl-10">HD</span><br/><span class="hl-9">resolutions</span><span class="hl-1">:</span><br/><span class="hl-1">  - </span><span class="hl-9">width</span><span class="hl-1">: </span><span class="hl-7">1920</span><br/><span class="hl-1">    </span><span class="hl-9">height</span><span class="hl-1">: </span><span class="hl-7">1080</span><br/><span class="hl-9">bitrates</span><span class="hl-1">:</span><br/><span class="hl-1">  - </span><span class="hl-7">0</span><br/><span class="hl-9">pipelineVariables</span><span class="hl-1">:</span><br/><span class="hl-1">  </span><span class="hl-9">QVBR</span><span class="hl-1">:</span><br/><span class="hl-1">    - </span><span class="hl-7">6</span><br/><span class="hl-1">    - </span><span class="hl-7">7</span><br/><span class="hl-1">    - </span><span class="hl-7">8</span><br/><span class="hl-1">    - </span><span class="hl-7">9</span>
</code></pre>

<a href="#generate-vmaf-measurements-example" id="generate-vmaf-measurements-example" style="color: inherit; text-decoration: none;">
  <h4>Generate VMAF measurements example</h4>
</a>
<pre><code class="language-bash"><span class="hl-1">autovmaf --resolutions 1920x1080,1280x720,960x540 --bitrates 500k,800k,1200k,1600k,2000k,3000k,4000k --name my-autovmaf-test1 my-source-video.mp4</span>
</code></pre>
<p>With the above command, when the run is finished transcoded files will be available in the folder <code>my-autovmaf-test1</code>, and vmaf-data in the folder <code>my-autovmaf-test1/HD</code>.</p>

<a href="#exporting-results-to-csv" id="exporting-results-to-csv" style="color: inherit; text-decoration: none;">
  <h3>Exporting results to csv</h3>
</a>
<p>To export results to csv, use the <code>export-csv</code> command.</p>
<pre><code><span class="hl-6">autovmaf</span><span class="hl-1"> </span><span class="hl-0">export</span><span class="hl-1">-</span><span class="hl-6">csv</span><span class="hl-1"> &lt;</span><span class="hl-6">folder</span><span class="hl-1">&gt;</span><br/><br/><span class="hl-6">Export</span><span class="hl-1"> </span><span class="hl-6">Vmaf</span><span class="hl-1"> </span><span class="hl-6">results</span><span class="hl-1"> </span><span class="hl-5">as</span><span class="hl-1"> </span><span class="hl-11">csv</span><br/><br/><span class="hl-12">Positionals</span><span class="hl-1">:</span><br/><span class="hl-1">  </span><span class="hl-6">folder</span><span class="hl-1">  </span><span class="hl-6">Folder</span><span class="hl-1"> </span><span class="hl-5">with</span><span class="hl-1"> </span><span class="hl-6">vmaf</span><span class="hl-1"> </span><span class="hl-6">measurement</span><span class="hl-1"> </span><span class="hl-6">results</span><span class="hl-1">               [</span><span class="hl-6">string</span><span class="hl-1">] [</span><span class="hl-6">required</span><span class="hl-1">]</span><br/><br/><span class="hl-12">Options</span><span class="hl-1">:</span><br/><span class="hl-1">  --</span><span class="hl-6">version</span><span class="hl-1">       </span><span class="hl-6">Show</span><span class="hl-1"> </span><span class="hl-6">version</span><span class="hl-1"> </span><span class="hl-6">number</span><span class="hl-1">                                  [</span><span class="hl-6">boolean</span><span class="hl-1">]</span><br/><span class="hl-1">  --</span><span class="hl-6">help</span><span class="hl-1">          </span><span class="hl-6">Show</span><span class="hl-1"> </span><span class="hl-6">help</span><span class="hl-1">                                            [</span><span class="hl-6">boolean</span><span class="hl-1">]</span><br/><span class="hl-1">  --</span><span class="hl-6">probeBitrate</span><span class="hl-1">  </span><span class="hl-6">Read</span><span class="hl-1"> </span><span class="hl-6">bitrate</span><span class="hl-1"> </span><span class="hl-0">of</span><span class="hl-1"> </span><span class="hl-6">transcoded</span><span class="hl-1"> </span><span class="hl-6">file</span><span class="hl-1"> </span><span class="hl-5">with</span><span class="hl-1"> </span><span class="hl-6">ffprobe</span><br/><span class="hl-1">                                                      [</span><span class="hl-6">boolean</span><span class="hl-1">] [</span><span class="hl-6">default</span><span class="hl-1">: </span><span class="hl-0">false</span><span class="hl-1">]</span><br/><span class="hl-1">  --</span><span class="hl-6">variables</span><span class="hl-1">     </span><span class="hl-6">List</span><span class="hl-1"> </span><span class="hl-0">of</span><span class="hl-1"> </span><span class="hl-6">variables</span><span class="hl-1"> </span><span class="hl-6">to</span><span class="hl-1"> </span><span class="hl-6">include</span><span class="hl-1"> </span><span class="hl-5">as</span><span class="hl-1"> </span><span class="hl-11">columns</span><span class="hl-1"> </span><span class="hl-11">in</span><span class="hl-1"> </span><span class="hl-11">csv</span><span class="hl-1">        [</span><span class="hl-11">string</span><span class="hl-1">]</span>
</code></pre>
<p>If your job uses variables (<a href="#using-variables-in-the-job-definition">See above</a>), the variables that should
be included in the csv data should be specified with the <code>--variables</code> option.</p>

<a href="#development" id="development" style="color: inherit; text-decoration: none;">
  <h2>Development</h2>
</a>

<a href="#run-tests" id="run-tests" style="color: inherit; text-decoration: none;">
  <h3>Run tests</h3>
</a>
<pre><code class="language-bash"><span class="hl-1">npm </span><span class="hl-3">test</span>
</code></pre>

<a href="#about-eyevinn-technology" id="about-eyevinn-technology" style="color: inherit; text-decoration: none;">
  <h1>About Eyevinn Technology</h1>
</a>
<p>Eyevinn Technology is an independent consultant firm specialized in video and streaming. Independent in a way that we are not commercially tied to any platform or technology vendor.</p>
<p>At Eyevinn, every software developer consultant has a dedicated budget reserved for open source development and contribution to the open source community. This give us room for innovation, team building and personal competence development. And also gives us as a company a way to contribute back to the open source community.</p>
<p>Want to know more about Eyevinn and how it is to work here. Contact us at <a href="mailto:work@eyevinn.se">work@eyevinn.se</a>!</p>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li><li class=" tsd-kind-namespace"><a href="modules/initJobLambda.html">init<wbr/>Job<wbr/>Lambda</a></li><li class=" tsd-kind-namespace"><a href="modules/startJobLambda.html">start<wbr/>Job<wbr/>Lambda</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-enum"><a href="enums/QualityAnalysisModel.html" class="tsd-kind-icon">Quality<wbr/>Analysis<wbr/>Model</a></li><li class="tsd-kind-class"><a href="classes/AWSPipeline.html" class="tsd-kind-icon">AWSPipeline</a></li><li class="tsd-kind-class"><a href="classes/LocalPipeline.html" class="tsd-kind-icon">Local<wbr/>Pipeline</a></li><li class="tsd-kind-class"><a href="classes/Pipeline.html" class="tsd-kind-icon">Pipeline</a></li><li class="tsd-kind-type-alias"><a href="modules.html#AWSPipelineConfiguration" class="tsd-kind-icon">AWSPipeline<wbr/>Configuration</a></li><li class="tsd-kind-type-alias"><a href="modules.html#BitrateRange" class="tsd-kind-icon">Bitrate<wbr/>Range</a></li><li class="tsd-kind-type-alias"><a href="modules.html#BitrateResolutionVMAF" class="tsd-kind-icon">Bitrate<wbr/>ResolutionVMAF</a></li><li class="tsd-kind-type-alias"><a href="modules.html#JobDescription" class="tsd-kind-icon">Job<wbr/>Description</a></li><li class="tsd-kind-type-alias"><a href="modules.html#LocalPipelineConfiguration" class="tsd-kind-icon">Local<wbr/>Pipeline<wbr/>Configuration</a></li><li class="tsd-kind-type-alias"><a href="modules.html#Resolution" class="tsd-kind-icon">Resolution</a></li><li class="tsd-kind-variable"><a href="modules.html#logger" class="tsd-kind-icon">logger</a></li><li class="tsd-kind-function"><a href="modules.html#createJob" class="tsd-kind-icon">create<wbr/>Job</a></li><li class="tsd-kind-function"><a href="modules.html#getAnalysisData" class="tsd-kind-icon">get<wbr/>Analysis<wbr/>Data</a></li><li class="tsd-kind-function"><a href="modules.html#loadPipeline" class="tsd-kind-icon">load<wbr/>Pipeline</a></li><li class="tsd-kind-function"><a href="modules.html#loadPipelineFromObjects" class="tsd-kind-icon">load<wbr/>Pipeline<wbr/>From<wbr/>Objects</a></li><li class="tsd-kind-function"><a href="modules.html#qualityAnalysisModelToString" class="tsd-kind-icon">quality<wbr/>Analysis<wbr/>Model<wbr/>To<wbr/>String</a></li><li class="tsd-kind-function"><a href="modules.html#stringToQualityAnalysisModel" class="tsd-kind-icon">string<wbr/>To<wbr/>Quality<wbr/>Analysis<wbr/>Model</a></li><li class="tsd-kind-function"><a href="modules.html#suggestLadder" class="tsd-kind-icon">suggest<wbr/>Ladder</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li><li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private property</span></li><li class="tsd-kind-method tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private method</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>